# Onliner Tech Telegram Bot

Парсер раздела технологий onliner.by с публикацией новостей в Telegram-канал.

## Возможности

- Два режима работы:
  - `last24h`: найти все новости за последние 24 часа и опубликовать.
  - `watch`: непрерывный режим, проверка новых новостей с интервалом.
- Интеллектуальная суммаризация через Ollama HTTP API (без сборки C++ и `llama-cpp-python`).
- Автовыбор модели:
  - `llama3.1:8b` (при наличии в Ollama; обычно на GPU).
  - fallback: `mistral:7b`.
  - если Ollama недоступна или модели отсутствуют: безопасное сокращение без LLM.
- Пост формируется как:
  - `TITLE` (жирным)
  - пустая строка
  - `BODY`
  - пустая строка
  - кликабельный текст ссылки на оригинал: `Источник` для коротких статей или `Подробнее...` для длинных (body > 1500 символов)
- Гарантия лимита Telegram caption (`1024` символа): итеративная суммаризация + аккуратное сокращение по предложениям.

## Быстрый старт

```powershell
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

Создайте `.env`:

```env
TELEGRAM_BOT_TOKEN=...
TELEGRAM_CHANNEL=@your_channel
```

## Ollama

Установите Ollama и загрузите модели:

```bash
ollama pull llama3.1:8b
ollama pull mistral:7b
```

Проверьте, что сервер Ollama доступен на `http://localhost:11434`.

## Запуск

```bash
python onliner_bot.py last24h
python onliner_bot.py watch --interval 300
```

## Настройки

- `--interval` — интервал проверки (в секундах) для режима `watch`.
- `--state-file` — путь к файлу состояния для хранения уже опубликованных ссылок (используется и в `watch`, и в `last24h`, чтобы не публиковать повторно между перезапусками).
  Старые ссылки автоматически удаляются из state-файла, если их возраст по дате в URL превышает 7 дней.

## Как работает суммаризация

1. Берется полный текст статьи (все абзацы), заголовок и ссылка.
2. Если пост укладывается в `1024` символа — публикуется без изменений.
3. Если длиннее — body суммаризируется до `950` символов.
4. Если всё ещё длинно — до 3 дополнительных итераций с лимитами `900`, `850`, `800`.
5. Если лимит всё ещё превышен — аккуратное сокращение по предложениям.
6. При ошибках HTTP/пустом ответе Ollama используется fallback без LLM.
7. Из текста удаляются служебные/редакционные CTA-фразы, не относящиеся к содержанию новости.
8. Внизу поста добавляется кликабельный источник: `Источник` или `Подробнее...` (если статья длиннее 1500 символов).

## Примечание

Парсинг основан на HTML-разметке onliner.by и может потребовать корректировки при изменениях сайта.
